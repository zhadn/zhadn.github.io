<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="style.css">
		<title>Zhadn's VGM Playlist</title>
		<meta name="description" content="Listen to Zhadn's Video Game Music (VGM) Playlist.">
		
		<!-- Z icon by Icons8 -->
		<link rel="icon" type="image/x-icon" href="favicon.ico">
	</head>
	<body>
		<div id="audio-card-container">
			<div id="title"><h1>Zhadn's VGM Playlist</h1></div>
			<div id="audio-player-container">
				<audio id="audio-player"
				controls
				autoplay
				preload="auto">
					<source id="vgm-track"
					src=""
					type="audio/mpeg">
					Your browser does not support the audio element.
				</audio>
			</div>
		</div>
		<div id="tracks">
			<ul id="vgm-tracks">
				<li data-path="music/chrono-cross-dream-of-the-shore-near-another-world.mp3"
				background-path="images/backgrounds/chrono-cross.jpeg"
				onClick="playVGMTrack(this)"><span>Chrono Cross - Dream of the Shore Near Another World</span></li>
				
				<li data-path="music/deltarune-field-of-hopes-and-dreams.mp3"
				background-path="images/backgrounds/deltarune.jpeg"
				onClick="playVGMTrack(this)"><span>Deltarune - Field of Hopes and Dreams</span></li>
				
				<li data-path="music/donkey-kong-country-aquatic-ambience.mp3"
				background-path="images/backgrounds/donkey-kong-country.jpeg"
				onClick="playVGMTrack(this)"><span>Donkey Kong Country - Aquatic Ambience</span></li>
				
				<li data-path="music/final-fantasy-x-sprouting.mp3"
				background-path="images/backgrounds/final-fantasy-x.png"
				onClick="playVGMTrack(this)"><span>Final Fantasy X - Sprouting</span></li>
				
				<li data-path="music/fire-emblem-three-houses-the-apex-of-the-world-(rain).mp3"
				background-path="images/backgrounds/fire-emblem-three-houses.jpeg"
				onClick="playVGMTrack(this)"><span>Fire Emblem: Three Houses - The Apex of the World (Rain)</span></li>
				
				<li data-path="music/ghost-of-tsushima-sacrifice-of-tradition.mp3"
				background-path="images/backgrounds/ghost-of-tsushima.jpeg"
				onClick="playVGMTrack(this)"><span>Ghost of Tsushima - Sacrifice of Tradition</span></li>
				
				<li data-path="music/kingdom-hearts-hollow-bastion.mp3"
				background-path="images/backgrounds/kingdom-hearts.jpeg"
				onClick="playVGMTrack(this)"><span>Kingdom Hearts - Hollow Bastion</span></li>
				
				<li data-path="music/minecraft-mice-on-venus.mp3"
				background-path="images/backgrounds/minecraft.jpeg"
				onClick="playVGMTrack(this)"><span>Minecraft - Mice on Venus</span></li>			
				
				<li data-path="music/octopath-traveler-main-theme.mp3"
				background-path="images/backgrounds/octopath-traveler.jpeg"
				onClick="playVGMTrack(this)"><span>Octopath Traveler - Main Theme</span></li>
				
				<li data-path="music/phoenix-wright-ace-attorney-dick-gumshoe-detective-gumshoe-pal.mp3"
				background-path="images/backgrounds/phoenix-wright.jpeg"
				onClick="playVGMTrack(this)"><span>Phoenix Wright: Ace Attorney - Dick Gumshoe ~ Detective Gumshoe, Pal</span></li>
				
				<li data-path="music/xenoblade-chronicles-x-nightl.mp3"
				background-path="images/backgrounds/xenoblade-chronicles-x.png"
				onClick="playVGMTrack(this)"><span>Xenoblade Chronicles X - N木ig木ht木L</span></li>
			</ul>
		</div>
		<div id="audio-controls">
			<button onclick="AUDIO_PLAYER.play()">Play</button>
			<button onclick="AUDIO_PLAYER.pause()">Pause</button>
			<button onclick="AUDIO_PLAYER.muted = !AUDIO_PLAYER.muted">Mute</button>
			<button onclick="changeVolume(0.1)">+</button>
			<button onclick="changeVolume(-0.1)">-</button>
		</div>
	</body>
	<script>
		
		var AUDIO_PLAYER = document.getElementById("audio-player");
		var VGM_TRACK = document.getElementById("vgm-track");
		const NOW_PLAYING = "playing";
		
		setAudioDefaults();
		playVGMTrack(chooseRandomTrack());
		
		AUDIO_PLAYER.onended = function() {
			playVGMTrack(chooseRandomTrack());
		};
		
		function playVGMTrack(track) {
			
			let lastPlayedTrack = document.getElementsByClassName(NOW_PLAYING)[0];
			
			if (lastPlayedTrack){
				lastPlayedTrack.classList.remove(NOW_PLAYING);
			}
			
			track.classList.add(NOW_PLAYING);
			VGM_TRACK.src = track.getAttribute("data-path");
			
			manageMediaControls(track);
			
			AUDIO_PLAYER.load();
			
			setGameBackgroundImage(track.getAttribute("background-path"));
		}
		
		function chooseRandomTrack() {
			
			let vgmTracks = document.getElementById("vgm-tracks");
			let listOfTracks = vgmTracks.getElementsByTagName('li');
			let numberOfTracks = listOfTracks.length;
			
			do {
				var randomTrackID = Math.floor(Math.random() * numberOfTracks);
			} while (listOfTracks[randomTrackID].classList.contains(NOW_PLAYING));
			
			return listOfTracks[randomTrackID];
		}
		
		function setGameBackgroundImage(background) {
			
			document.body.style.backgroundImage = "url('"+background+"')";	
		}
		
		function setAudioDefaults() {
			
			AUDIO_PLAYER.volume = 0.2;	
		}
		
		function manageMediaControls(track) {
			
			let trackInfo = track.innerText;			
			let trackInfoArray = trackInfo.split("-");

			let albumName = trackInfoArray[0].trim();
			let titleName = trackInfoArray[1].trim();

			if ('mediaSession' in navigator) {
				navigator.mediaSession.metadata = new MediaMetadata({
					title: albumName,
					album: titleName,
			  });
			}
		}
		
		function changeVolume(increment) {
			
			// console.log("START: " + AUDIO_PLAYER.volume);
			newIncrement = (AUDIO_PLAYER.volume + increment).toFixed(2);
			
			if (newIncrement >= 0 && newIncrement <= 1){
				AUDIO_PLAYER.volume=newIncrement;
				console.log("END:"
				+
				AUDIO_PLAYER.volume);
			}
		}
	</script>
</html>
